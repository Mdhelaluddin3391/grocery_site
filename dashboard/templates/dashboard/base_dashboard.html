{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Commerce Control Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 2px; }
        .main-scroll::-webkit-scrollbar { width: 6px; }
        .main-scroll::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 3px; }
        #map { height: 75vh; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 flex-shrink-0 bg-gray-900 text-gray-300 flex flex-col sidebar-scroll overflow-y-auto">
            <div class="h-16 flex items-center justify-center px-6 flex-shrink-0 border-b border-gray-800">
                <h1 class="text-xl font-bold text-white">QuickDash</h1>
            </div>
            <nav class="flex-1 px-4 py-4 space-y-1">
                <a href="{% url 'dashboard_home' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'dashboard_home' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Home (Overview)</a>
                <a href="{% url 'live_orders' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'live_orders' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Live Orders</a>
                <a href="{% url 'packed_orders' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'packed_orders' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Ready to Dispatch</a>
                <a href="{% url 'delivery_map' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'delivery_map' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Delivery Map</a>
                <a href="{% url 'wms_dashboard' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'wms_dashboard' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">WMS</a>
                <a href="{% url 'customers' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'customers' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Customers</a>
                <a href="{% url 'rider_dashboard' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'rider_dashboard' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Riders (Manager)</a>
                <a href="{% url 'finance' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'finance' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Finance & Reports</a>
                <a href="{% url 'analytics' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'analytics' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">Analytics</a>
                
                <hr class="border-gray-700 my-2">
                
                <a href="{% url 'picker_dashboard' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if 'picking' in request.resolver_match.app_names %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">My Picking Jobs</a>
                <a href="{% url 'rider_app_dashboard' %}" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md {% if request.resolver_match.url_name == 'rider_app_dashboard' %}text-white bg-gray-800{% else %}text-gray-400 hover:bg-gray-800 hover:text-white{% endif %}">My Deliveries</a>

                <hr class="border-gray-700 my-2">

                <a href="/admin/" target="_blank" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-400 hover:bg-gray-800 hover:text-white">Admin Panel</a>
            </nav>

            <div class="px-4 py-4 mt-auto border-t border-gray-800 flex-shrink-0">
                <div class="flex items-center">
                    <div>
                        <p class="text-sm font-medium text-white">{{ request.user.name|default:request.user.email }}</p>
                        <a href="{% url 'staff_logout' %}" class="text-xs text-red-400 hover:text-red-300">Logout</a>
                    </div>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-16 flex items-center justify-between px-8 bg-white border-b border-gray-200 flex-shrink-0">
                <h1 class="text-2xl font-semibold text-gray-800">{% block page_title %}Dashboard Overview{% endblock page_title %}</h1>
                <span class="text-sm text-gray-500">Welcome, {{ request.user.name }}</span>
            </header>
            <div class="flex-1 overflow-y-auto main-scroll p-6 lg:p-8">
                {% block content %}{% endblock content %}
            </div>
        </div>
    </div>

</body>
</html>