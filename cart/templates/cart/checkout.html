{# cart/templates/cart/checkout.html #}
{% extends 'store/base.html' %}
{% load static %}
{# ... (style block waise hi rahega) ... #}

{% block content %}
<div class="checkout-container">
    {% if not user.is_authenticated %}
        <div class="checkout-login-prompt" style="text-align: center; padding: 40px; background: #fff; border-radius: 8px;">
            <h2>Please Log In</h2>
            <p>You need to be logged in to proceed with checkout.</p>
            <a href="{% url 'login' %}?next={{ request.path }}" class="btn-submit" style="text-decoration: none; display: inline-block; width: auto; padding: 12px 25px;">Login or Register</a>
        </div>
    {% else %}
        <h1>Checkout</h1>
        <form method="post" novalidate id="checkout-form">
            {# ... (baaki form waise hi rahega) ... #}
            {% csrf_token %}
            <input type="hidden" name="latitude" id="id_latitude">
            <input type="hidden" name="longitude" id="id_longitude">

            <div class="checkout-step">
                <h3>1. Shipping Address</h3>
                {% if addresses %}
                    {% for address in addresses %}
                    <label for="address-{{ address.id }}" class="address-card">
                        <input type="radio" name="address_choice" value="existing" id="address-{{ address.id }}" onclick="document.getElementById('selected_address_id').value='{{ address.id }}'">
                        <div>
                            <strong>{{ address.get_address_type_display }}</strong>
                            <p>{{ address.address_line_1 }}, {% if address.address_line_2 %}{{ address.address_line_2 }},{% endif %} {{ address.city }}, {{ address.state }} - {{ address.pincode }}</p>
                        </div>
                    </label>
                    {% endfor %}
                    <input type="hidden" name="selected_address" id="selected_address_id">
                {% endif %}

                <label for="new-address-radio" class="address-card">
                    <input type="radio" name="address_choice" value="new" id="new-address-radio" {% if not addresses %}checked{% endif %}>
                    <strong>Add a New Address</strong>
                </label>

                <div id="new-address-form" style="margin-top: 15px; {% if addresses %}display:none;{% endif %}">
                    <p style="text-align: center; color: #555; margin: 15px 0;">
    <strong>Quickly fill your address using your current location, or feel free to enter it manually below.</strong>                </p>
                    <div class="location-btn-container">
                        <button type="button" class="location-btn" onclick="getLocation()">ğŸ“ Use My Current Location</button>
                    </div>
                    <div id="map"></div>
                    <div class="form-group">{{ address_form.as_p }}</div>
                </div>
            </div>

            <div class="checkout-step">
                <h3>2. Payment Method</h3>
                <label for="cod" class="payment-option selected">
                    <input type="radio" id="cod" name="payment_method" value="COD" checked>
                    <label for="cod">Cash on Delivery (COD)</label>
                </label>
                <label for="upi" class="payment-option disabled">
                    <input type="radio" id="upi" name="payment_method" value="UPI" disabled>
                    <label for="upi">UPI / Online Payment (Currently Unavailable)</label>
                </label>
            </div>

            {% if error %}
                <p class="error-message">{{ error }}</p>
            {% endif %}

            <button type="submit" class="btn-submit">Place Order</button>
        </form>
    {% endif %}
</div>
{% endblock content %}

{# ... (extra_js block waise hi rahega) ... #}